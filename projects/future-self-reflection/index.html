<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Self Reflection System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4a6fa5;
            --primary-light: #6b8cc0;
            --secondary: #ff9a76;
            --accent: #8b80f9;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 10px;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        header {
            text-align: center;
            padding: 3rem 1rem 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .tagline {
            font-style: italic;
            margin-top: 1rem;
            opacity: 0.8;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        /* Card Styling */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.8rem;
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 1.2rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.7rem;
        }

        .card-title i {
            color: var(--accent);
        }

        /* Form Styling */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        textarea, select, input {
            width: 100%;
            padding: 0.9rem;
            border: 2px solid #e1e5eb;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border 0.3s ease;
        }

        textarea {
            min-height: 180px;
            resize: vertical;
            font-family: inherit;
        }

        textarea:focus, select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(74, 111, 165, 0.25);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #ffb896 100%);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent) 0%, #a89cf9 100%);
        }

        /* Timeline Styling */
        .timeline {
            position: relative;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 2.5rem;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary);
            border-radius: 2px;
        }

        @media (max-width: 768px) {
            .timeline::before {
                left: 1.5rem;
            }
        }

        .timeline-item {
            position: relative;
            padding-left: 5rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .timeline-item {
                padding-left: 3.5rem;
            }
        }

        .timeline-icon {
            position: absolute;
            left: 2rem;
            top: 0;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        @media (max-width: 768px) {
            .timeline-icon {
                left: 0;
                width: 2.5rem;
                height: 2.5rem;
                font-size: 1rem;
            }
        }

        .timeline-date {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 0.3rem;
            font-weight: 600;
        }

        .timeline-category {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
        }

        .category-career { background-color: #d4edda; color: #155724; }
        .category-health { background-color: #d1ecf1; color: #0c5460; }
        .category-personal { background-color: #f8d7da; color: #721c24; }
        .category-studies { background-color: #fff3cd; color: #856404; }

        .message-preview {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary);
            margin-bottom: 1rem;
            font-style: italic;
        }

        .locked-message {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .locked-message i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--gray);
        }

        .reflection-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 1rem;
            border-left: 4px solid var(--secondary);
        }

        .reflection-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .reflection-item {
            background: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border-left: 3px solid var(--accent);
        }

        .reflection-date {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .message-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .message-actions .btn {
            width: auto;
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
        }

        .section-divider {
            display: flex;
            align-items: center;
            margin: 2rem 0;
            color: var(--gray);
        }

        .section-divider::before, .section-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e1e5eb;
        }

        .section-divider span {
            padding: 0 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #e1e5eb;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.2rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.3rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .notification {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            padding: 1rem 1.5rem;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transform: translateX(150%);
            transition: transform 0.4s ease;
            z-index: 1000;
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification i {
            font-size: 1.5rem;
        }

        .notification-success i {
            color: var(--success);
        }

        .notification-warning i {
            color: var(--warning);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e1e5eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .prompt-list {
            margin: 1.5rem 0;
        }

        .prompt-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent);
        }

        .chat-style {
            max-height: 300px;
            overflow-y: auto;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .message-bubble {
            max-width: 80%;
            padding: 0.8rem 1rem;
            border-radius: 18px;
            margin-bottom: 1rem;
            position: relative;
        }

        .past-self {
            background: #e9ecef;
            color: var(--dark);
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }

        .present-self {
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
            margin-left: auto;
            align-self: flex-end;
        }

        .message-sender {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .past-self .message-sender {
            color: var(--primary);
        }

        .present-self .message-sender {
            color: #ffebee;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-hourglass-half"></i> Future Self Reflection</h1>
            <p class="subtitle">Write messages to your future self, reflect on your growth, and have meaningful conversations across time</p>
            <p class="tagline">"The best time to plant a tree was 20 years ago. The second best time is now."</p>
        </div>
    </header>

    <main class="container">
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="totalMessages">0</div>
                <div class="stat-label">Total Messages</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="unlockedMessages">0</div>
                <div class="stat-label">Unlocked</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="reflectedMessages">0</div>
                <div class="stat-label">Reflected On</div>
            </div>
        </div>

        <div class="app-container">
            <!-- Left Column: Message Creation -->
            <div class="left-column">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-pen-fancy"></i> Write to Your Future Self</h2>
                    <form id="messageForm">
                        <div class="form-group">
                            <label for="message">Your Message</label>
                            <textarea id="message" placeholder="Dear future me, I hope you're doing well. Remember to keep pursuing your dreams and never give up on what truly matters to you..." required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="unlockDate">Unlock Date</label>
                            <input type="date" id="unlockDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="category">Category</label>
                            <select id="category">
                                <option value="personal">Personal Growth</option>
                                <option value="career">Career</option>
                                <option value="health">Health & Wellness</option>
                                <option value="studies">Studies & Learning</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn">
                            <i class="fas fa-lock"></i> Save for the Future
                        </button>
                    </form>
                </div>
                
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-lightbulb"></i> Reflection Prompts</h2>
                    <p>When your message unlocks, use these prompts to guide your reflection:</p>
                    <div class="prompt-list">
                        <div class="prompt-item">
                            <strong>1. Did you achieve what you hoped for?</strong>
                            <p>What progress have you made toward the goals mentioned?</p>
                        </div>
                        <div class="prompt-item">
                            <strong>2. What has changed since then?</strong>
                            <p>How have your perspectives, values, or circumstances shifted?</p>
                        </div>
                        <div class="prompt-item">
                            <strong>3. What would you tell your past self now?</strong>
                            <p>What advice, encouragement, or insights would you share?</p>
                        </div>
                    </div>
                    <button id="viewPromptsBtn" class="btn btn-secondary">
                        <i class="fas fa-question-circle"></i> View All Prompts
                    </button>
                </div>
            </div>
            
            <!-- Right Column: Reflection Timeline -->
            <div class="right-column">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-history"></i> Reflection Timeline</h2>
                    
                    <div class="section-divider">
                        <span>Upcoming Messages</span>
                    </div>
                    
                    <div id="lockedMessagesContainer">
                        <!-- Locked messages will appear here -->
                        <div class="empty-state" id="emptyLocked">
                            <i class="fas fa-lock"></i>
                            <h3>No locked messages</h3>
                            <p>Write a message to your future self to see it here</p>
                        </div>
                    </div>
                    
                    <div class="section-divider">
                        <span>Unlocked Reflections</span>
                    </div>
                    
                    <div id="unlockedMessagesContainer">
                        <!-- Unlocked messages will appear here -->
                        <div class="empty-state" id="emptyUnlocked">
                            <i class="fas fa-inbox"></i>
                            <h3>No unlocked messages yet</h3>
                            <p>Your future messages will appear here when they unlock</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <div>
            <strong id="notificationTitle">Success</strong>
            <p id="notificationMessage">Your message has been saved successfully!</p>
        </div>
    </div>

    <!-- Reflection Modal -->
    <div class="modal" id="reflectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reflect on Your Past Self</h2>
                <button class="close-modal" id="closeReflectionModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="chat-style" id="chatContainer">
                    <!-- Past and present messages will appear here -->
                </div>
                
                <div class="prompt-list">
                    <div class="prompt-item">
                        <strong>Reflection Prompts</strong>
                        <p>1. How do you feel reading this message from your past self?</p>
                        <p>2. What has changed in your life since you wrote this?</p>
                        <p>3. What advice would you give your past self now?</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="reflectionText">Your Reflection</label>
                    <textarea id="reflectionText" placeholder="Write your reflection here... What would you tell your past self now?"></textarea>
                </div>
                
                <button id="saveReflectionBtn" class="btn btn-accent">
                    <i class="fas fa-reply"></i> Reply to Past Self
                </button>
            </div>
        </div>
    </div>

    <!-- Prompts Modal -->
    <div class="modal" id="promptsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-question-circle"></i> Reflection Prompts</h2>
                <button class="close-modal" id="closePromptsModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>When your future messages unlock, use these prompts to guide your reflection:</p>
                
                <div class="prompt-list">
                    <div class="prompt-item">
                        <strong>1. Progress Check</strong>
                        <p>Did you achieve what you hoped for? What progress have you made toward the goals mentioned in your message?</p>
                    </div>
                    <div class="prompt-item">
                        <strong>2. Change & Growth</strong>
                        <p>What has changed since you wrote this message? How have your perspectives, values, or circumstances shifted?</p>
                    </div>
                    <div class="prompt-item">
                        <strong>3. Emotional Reflection</strong>
                        <p>How do you feel reading this message now? What emotions does it bring up - nostalgia, pride, motivation?</p>
                    </div>
                    <div class="prompt-item">
                        <strong>4. Advice to Past Self</strong>
                        <p>What would you tell your past self now? What advice, encouragement, or insights would you share?</p>
                    </div>
                    <div class="prompt-item">
                        <strong>5. Future Looking</strong>
                        <p>Based on this reflection, what do you want to remember for your future self? What intentions do you want to set?</p>
                    </div>
                </div>
                
                <p class="tagline" style="text-align: center; margin-top: 1.5rem;">"We do not learn from experience... we learn from reflecting on experience." - John Dewey</p>
            </div>
        </div>
    </div>

    <script>
        // Data structure for messages
        let messages = JSON.parse(localStorage.getItem('futureSelfMessages')) || [];
        let currentMessageId = null;

        // DOM elements
        const messageForm = document.getElementById('messageForm');
        const messageInput = document.getElementById('message');
        const unlockDateInput = document.getElementById('unlockDate');
        const categoryInput = document.getElementById('category');
        const lockedMessagesContainer = document.getElementById('lockedMessagesContainer');
        const unlockedMessagesContainer = document.getElementById('unlockedMessagesContainer');
        const emptyLocked = document.getElementById('emptyLocked');
        const emptyUnlocked = document.getElementById('emptyUnlocked');
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const reflectionModal = document.getElementById('reflectionModal');
        const promptsModal = document.getElementById('promptsModal');
        const closeReflectionModal = document.getElementById('closeReflectionModal');
        const closePromptsModal = document.getElementById('closePromptsModal');
        const saveReflectionBtn = document.getElementById('saveReflectionBtn');
        const reflectionText = document.getElementById('reflectionText');
        const chatContainer = document.getElementById('chatContainer');
        const viewPromptsBtn = document.getElementById('viewPromptsBtn');
        
        // Stats elements
        const totalMessagesEl = document.getElementById('totalMessages');
        const unlockedMessagesEl = document.getElementById('unlockedMessages');
        const reflectedMessagesEl = document.getElementById('reflectedMessages');

        // Set minimum date for unlock date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        unlockDateInput.min = tomorrow.toISOString().split('T')[0];
        
        // Set default unlock date to 1 month from now
        const oneMonthFromNow = new Date();
        oneMonthFromNow.setMonth(oneMonthFromNow.getMonth() + 1);
        unlockDateInput.value = oneMonthFromNow.toISOString().split('T')[0];

        // Initialize the app
        function init() {
            renderMessages();
            updateStats();
            
            // Check for any messages that should be unlocked today
            checkForUnlockedMessages();
        }

        // Check for messages that should be unlocked
        function checkForUnlockedMessages() {
            const today = new Date().toISOString().split('T')[0];
            let hasNewUnlocks = false;
            
            messages.forEach(message => {
                if (!message.isUnlocked && message.unlockDate <= today) {
                    message.isUnlocked = true;
                    hasNewUnlocks = true;
                }
            });
            
            if (hasNewUnlocks) {
                saveMessages();
                renderMessages();
                updateStats();
                showNotification("Messages Unlocked!", "You have new messages from your past self to reflect on.", "success");
            }
        }

        // Save messages to localStorage
        function saveMessages() {
            localStorage.setItem('futureSelfMessages', JSON.stringify(messages));
        }

        // Show notification
        function showNotification(title, message, type = "success") {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // Set icon based on type
            const icon = notification.querySelector('i');
            icon.className = type === "success" ? "fas fa-check-circle" : "fas fa-exclamation-circle";
            
            notification.className = `notification show notification-${type}`;
            
            // Hide after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Update statistics
        function updateStats() {
            const total = messages.length;
            const unlocked = messages.filter(m => m.isUnlocked).length;
            const reflected = messages.filter(m => m.reflections && m.reflections.length > 0).length;
            
            totalMessagesEl.textContent = total;
            unlockedMessagesEl.textContent = unlocked;
            reflectedMessagesEl.textContent = reflected;
        }

        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        // Render messages to the timeline
        function renderMessages() {
            // Clear containers
            lockedMessagesContainer.innerHTML = '';
            unlockedMessagesContainer.innerHTML = '';
            
            // Sort messages by unlock date (newest first)
            messages.sort((a, b) => new Date(b.unlockDate) - new Date(a.unlockDate));
            
            // Separate locked and unlocked messages
            const lockedMessages = messages.filter(m => !m.isUnlocked);
            const unlockedMessages = messages.filter(m => m.isUnlocked);
            
            // Show empty states if no messages
            if (lockedMessages.length === 0) {
                lockedMessagesContainer.appendChild(emptyLocked);
                emptyLocked.style.display = 'block';
            } else {
                emptyLocked.style.display = 'none';
            }
            
            if (unlockedMessages.length === 0) {
                unlockedMessagesContainer.appendChild(emptyUnlocked);
                emptyUnlocked.style.display = 'block';
            } else {
                emptyUnlocked.style.display = 'none';
            }
            
            // Render locked messages
            lockedMessages.forEach(message => {
                const messageElement = createMessageElement(message, false);
                lockedMessagesContainer.appendChild(messageElement);
            });
            
            // Render unlocked messages
            unlockedMessages.forEach(message => {
                const messageElement = createMessageElement(message, true);
                unlockedMessagesContainer.appendChild(messageElement);
            });
        }

        // Create a message element for the timeline
        function createMessageElement(message, isUnlocked) {
            const timelineItem = document.createElement('div');
            timelineItem.className = 'timeline-item';
            timelineItem.dataset.id = message.id;
            
            // Determine icon and color based on status
            let iconClass, iconColor;
            if (!isUnlocked) {
                iconClass = 'fas fa-lock';
                iconColor = '#6c757d';
            } else if (message.reflections && message.reflections.length > 0) {
                iconClass = 'fas fa-comment-dots';
                iconColor = '#8b80f9';
            } else {
                iconClass = 'fas fa-unlock';
                iconColor = '#28a745';
            }
            
            // Create timeline icon
            const iconDiv = document.createElement('div');
            iconDiv.className = 'timeline-icon';
            iconDiv.style.backgroundColor = iconColor;
            iconDiv.innerHTML = `<i class="${iconClass}"></i>`;
            
            // Create timeline content
            const contentDiv = document.createElement('div');
            
            // Date information
            const dateDiv = document.createElement('div');
            dateDiv.className = 'timeline-date';
            dateDiv.innerHTML = `<i class="far fa-calendar"></i> Written on ${formatDate(message.createdAt)} | Unlocks on ${formatDate(message.unlockDate)}`;
            
            // Category badge
            const categoryDiv = document.createElement('div');
            categoryDiv.className = `timeline-category category-${message.category}`;
            const categoryLabels = {
                'personal': 'Personal Growth',
                'career': 'Career',
                'health': 'Health & Wellness',
                'studies': 'Studies & Learning'
            };
            categoryDiv.textContent = categoryLabels[message.category] || message.category;
            
            // Message content
            const messageDiv = document.createElement('div');
            
            if (!isUnlocked) {
                // Locked message
                messageDiv.className = 'locked-message';
                messageDiv.innerHTML = `
                    <i class="fas fa-lock"></i>
                    <p>This message will unlock on <strong>${formatDate(message.unlockDate)}</strong></p>
                    <p>Only ${daysUntil(message.unlockDate)} days to go!</p>
                `;
            } else {
                // Unlocked message - show preview
                messageDiv.className = 'message-preview';
                const preview = message.message.length > 200 ? message.message.substring(0, 200) + '...' : message.message;
                messageDiv.textContent = preview;
                
                // Add reflection section if reflections exist
                if (message.reflections && message.reflections.length > 0) {
                    const reflectionDiv = document.createElement('div');
                    reflectionDiv.className = 'reflection-section';
                    
                    const reflectionTitle = document.createElement('div');
                    reflectionTitle.className = 'reflection-title';
                    reflectionTitle.innerHTML = `<i class="fas fa-reply"></i> Your Reflection`;
                    
                    reflectionDiv.appendChild(reflectionTitle);
                    
                    // Show the latest reflection
                    const latestReflection = message.reflections[message.reflections.length - 1];
                    const reflectionItem = document.createElement('div');
                    reflectionItem.className = 'reflection-item';
                    reflectionItem.innerHTML = `
                        <div class="reflection-date">Reflected on ${formatDate(latestReflection.reflectedAt)}</div>
                        <p>${latestReflection.response}</p>
                    `;
                    
                    reflectionDiv.appendChild(reflectionItem);
                    contentDiv.appendChild(reflectionDiv);
                }
            }
            
            // Action buttons
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'message-actions';
            
            if (!isUnlocked) {
                // Locked message actions
                const viewBtn = document.createElement('button');
                viewBtn.className = 'btn';
                viewBtn.innerHTML = `<i class="fas fa-eye"></i> View Locked`;
                viewBtn.onclick = () => {
                    showNotification("Message Locked", `This message will unlock on ${formatDate(message.unlockDate)}. Only ${daysUntil(message.unlockDate)} days to go!`, "warning");
                };
                actionsDiv.appendChild(viewBtn);
            } else {
                // Unlocked message actions
                const viewBtn = document.createElement('button');
                viewBtn.className = 'btn';
                viewBtn.innerHTML = `<i class="fas fa-eye"></i> ${message.reflections && message.reflections.length > 0 ? 'View Conversation' : 'Read & Reflect'}`;
                viewBtn.onclick = () => openReflectionModal(message.id);
                actionsDiv.appendChild(viewBtn);
                
                // Delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-secondary';
                deleteBtn.innerHTML = `<i class="fas fa-trash"></i> Delete`;
                deleteBtn.onclick = () => deleteMessage(message.id);
                actionsDiv.appendChild(deleteBtn);
            }
            
            // Assemble the timeline item
            contentDiv.appendChild(dateDiv);
            contentDiv.appendChild(categoryDiv);
            contentDiv.appendChild(messageDiv);
            contentDiv.appendChild(actionsDiv);
            
            timelineItem.appendChild(iconDiv);
            timelineItem.appendChild(contentDiv);
            
            return timelineItem;
        }

        // Calculate days until a date
        function daysUntil(dateString) {
            const today = new Date();
            const unlockDate = new Date(dateString);
            const diffTime = unlockDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Open reflection modal
        function openReflectionModal(messageId) {
            currentMessageId = messageId;
            const message = messages.find(m => m.id === messageId);
            
            if (!message) return;
            
            // Clear chat container
            chatContainer.innerHTML = '';
            
            // Add past self message
            const pastSelfDiv = document.createElement('div');
            pastSelfDiv.className = 'message-bubble past-self';
            pastSelfDiv.innerHTML = `
                <div class="message-sender"><i class="fas fa-user-clock"></i> Past You üï∞Ô∏è</div>
                <div>${message.message}</div>
                <div style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.7;">Written on ${formatDate(message.createdAt)}</div>
            `;
            chatContainer.appendChild(pastSelfDiv);
            
            // Add any existing reflections
            if (message.reflections && message.reflections.length > 0) {
                message.reflections.forEach(reflection => {
                    const reflectionDiv = document.createElement('div');
                    reflectionDiv.className = 'message-bubble present-self';
                    reflectionDiv.innerHTML = `
                        <div class="message-sender"><i class="fas fa-user-edit"></i> Present You ‚úçÔ∏è</div>
                        <div>${reflection.response}</div>
                        <div style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.7;">Reflected on ${formatDate(reflection.reflectedAt)}</div>
                    `;
                    chatContainer.appendChild(reflectionDiv);
                });
            }
            
            // Scroll to bottom of chat
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Clear reflection text area
            reflectionText.value = '';
            
            // Show modal
            reflectionModal.classList.add('show');
        }

        // Delete a message
        function deleteMessage(messageId) {
            if (confirm("Are you sure you want to delete this message? This action cannot be undone.")) {
                messages = messages.filter(m => m.id !== messageId);
                saveMessages();
                renderMessages();
                updateStats();
                showNotification("Message Deleted", "Your message has been permanently deleted.", "warning");
            }
        }

        // Event Listeners
        messageForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Create new message object
            const newMessage = {
                id: Date.now().toString(),
                message: messageInput.value,
                unlockDate: unlockDateInput.value,
                createdAt: new Date().toISOString().split('T')[0],
                category: categoryInput.value,
                isUnlocked: false,
                reflections: []
            };
            
            // Add to messages array
            messages.push(newMessage);
            
            // Save to localStorage
            saveMessages();
            
            // Reset form
            messageForm.reset();
            
            // Reset unlock date to default (1 month from now)
            const oneMonthFromNow = new Date();
            oneMonthFromNow.setMonth(oneMonthFromNow.getMonth() + 1);
            unlockDateInput.value = oneMonthFromNow.toISOString().split('T')[0];
            
            // Update UI
            renderMessages();
            updateStats();
            
            // Show success notification
            showNotification("Message Saved!", `Your message will unlock on ${formatDate(newMessage.unlockDate)}.`, "success");
        });

        saveReflectionBtn.addEventListener('click', function() {
            if (!currentMessageId || !reflectionText.value.trim()) {
                alert("Please write a reflection before saving.");
                return;
            }
            
            const message = messages.find(m => m.id === currentMessageId);
            if (!message) return;
            
            // Create new reflection
            const newReflection = {
                response: reflectionText.value,
                reflectedAt: new Date().toISOString().split('T')[0]
            };
            
            // Add to message reflections
            if (!message.reflections) {
                message.reflections = [];
            }
            message.reflections.push(newReflection);
            
            // Save messages
            saveMessages();
            
            // Update UI
            renderMessages();
            updateStats();
            
            // Close modal
            reflectionModal.classList.remove('show');
            
            // Show success notification
            showNotification("Reflection Saved!", "You've successfully replied to your past self.", "success");
        });

        closeReflectionModal.addEventListener('click', function() {
            reflectionModal.classList.remove('show');
        });

        closePromptsModal.addEventListener('click', function() {
            promptsModal.classList.remove('show');
        });

        viewPromptsBtn.addEventListener('click', function() {
            promptsModal.classList.add('show');
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target === reflectionModal) {
                reflectionModal.classList.remove('show');
            }
            if (e.target === promptsModal) {
                promptsModal.classList.remove('show');
            }
        });

        // Initialize the app
        init();
        
        // Add some sample data if no messages exist
        if (messages.length === 0) {
            // Add a sample locked message
            const sampleLocked = {
                id: "1",
                message: "Dear future me, I hope you're staying consistent with your morning routine. Remember how important it is for your mental clarity and productivity. Are you still meditating every day? Have you read all those books on your list? I believe in you!",
                unlockDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 14 days from now
                createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 7 days ago
                category: "personal",
                isUnlocked: false,
                reflections: []
            };
            
            // Add a sample unlocked message with reflection
            const sampleUnlocked = {
                id: "2",
                message: "Hey future me, I'm writing this during a challenging time at work. I'm wondering if you've found more balance between work and personal life. Have you learned to set better boundaries? I hope you're taking care of your health and making time for things that truly matter.",
                unlockDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 2 days ago
                createdAt: new Date(Date.now() - 32 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 32 days ago
                category: "career",
                isUnlocked: true,
                reflections: [
                    {
                        response: "Reading this brings back memories of that stressful period. I'm happy to report that I did learn to set better boundaries! I now leave work at 6 PM sharp most days and have started taking weekend hikes. The biggest lesson was realizing that constant overwork doesn't lead to better results - it just leads to burnout. I'm much happier now.",
                        reflectedAt: new Date().toISOString().split('T')[0]
                    }
                ]
            };
            
            messages.push(sampleLocked, sampleUnlocked);
            saveMessages();
            renderMessages();
            updateStats();
        }
    </script>
</body>
</html>