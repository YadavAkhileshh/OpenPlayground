<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Ledger Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 1);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .transaction-row {
            transition: all 0.2s ease;
        }
        .transaction-row:hover {
            background-color: #f1f5f9;
            transform: translateX(4px);
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Ledger Calculator</h1>
                <p class="text-slate-500">Track your finances with precision</p>
            </div>
            <div class="flex gap-2">
                <button onclick="exportToCSV()" class="px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-lg hover:bg-slate-50 transition font-medium flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Export CSV
                </button>
                <button onclick="clearAll()" class="px-4 py-2 bg-red-50 text-red-600 border border-red-100 rounded-lg hover:bg-red-100 transition font-medium">
                    Clear All
                </button>
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card p-6 rounded-2xl shadow-sm">
                <p class="text-sm font-medium text-slate-500 mb-1">Total Balance</p>
                <h2 id="totalBalance" class="text-3xl font-bold text-slate-900">$0.00</h2>
                <div class="mt-4 h-1 w-full bg-slate-100 rounded-full overflow-hidden">
                    <div id="balanceProgress" class="h-full bg-blue-500 transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
            <div class="glass-card p-6 rounded-2xl shadow-sm">
                <p class="text-sm font-medium text-slate-500 mb-1">Total Income</p>
                <h2 id="totalIncome" class="text-3xl font-bold text-emerald-600">$0.00</h2>
                <p class="text-xs text-slate-400 mt-2">Sum of all positive entries</p>
            </div>
            <div class="glass-card p-6 rounded-2xl shadow-sm">
                <p class="text-sm font-medium text-slate-500 mb-1">Total Expenses</p>
                <h2 id="totalExpenses" class="text-3xl font-bold text-rose-600">$0.00</h2>
                <p class="text-xs text-slate-400 mt-2">Sum of all negative entries</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Left Column: Add Transaction & Visualization -->
            <div class="lg:col-span-4 space-y-8">
                <!-- Entry Form -->
                <div class="glass-card p-6 rounded-2xl shadow-sm">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">Add Entry</h3>
                    <form id="ledgerForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
                            <input type="text" id="desc" required placeholder="e.g. Monthly Salary" class="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Amount</label>
                                <input type="number" id="amount" required step="0.01" placeholder="0.00" class="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Type</label>
                                <select id="type" class="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition bg-white">
                                    <option value="expense">Expense</option>
                                    <option value="income">Income</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Category</label>
                            <input type="text" id="category" list="category-options" placeholder="Select or type..." class="w-full px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition">
                            <datalist id="category-options">
                                <option value="Salary">
                                <option value="Food">
                                <option value="Rent">
                                <option value="Utilities">
                                <option value="Transport">
                                <option value="Entertainment">
                                <option value="Health">
                            </datalist>
                        </div>
                        <button type="submit" class="w-full py-3 bg-slate-900 text-white rounded-lg font-semibold hover:bg-slate-800 active:scale-[0.98] transition">
                            Record Transaction
                        </button>
                    </form>
                </div>

                <!-- Chart -->
                <div class="glass-card p-6 rounded-2xl shadow-sm">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">Composition</h3>
                    <div class="h-64 flex items-center justify-center">
                        <canvas id="balanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Right Column: List -->
            <div class="lg:col-span-8">
                <div class="glass-card rounded-2xl shadow-sm flex flex-col h-full overflow-hidden">
                    <!-- List Filter Header -->
                    <div class="p-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4 bg-white/50">
                        <h3 class="text-lg font-semibold text-slate-800">Transaction History</h3>
                        <div class="flex gap-2">
                            <input type="text" id="search" placeholder="Search..." class="px-3 py-1.5 rounded-lg border border-slate-200 text-sm outline-none focus:ring-2 focus:ring-blue-100">
                            <select id="filterCategory" class="px-3 py-1.5 rounded-lg border border-slate-200 text-sm outline-none bg-white">
                                <option value="all">All Categories</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Table -->
                    <div class="flex-grow overflow-y-auto custom-scrollbar max-h-[600px]">
                        <table class="w-full text-left border-collapse">
                            <thead class="sticky top-0 bg-slate-50 text-slate-500 text-xs font-semibold uppercase tracking-wider">
                                <tr>
                                    <th class="px-6 py-4">Date</th>
                                    <th class="px-6 py-4">Description</th>
                                    <th class="px-6 py-4 text-right">Category</th>
                                    <th class="px-6 py-4 text-right">Amount</th>
                                    <th class="px-6 py-4 text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody id="transactionList" class="divide-y divide-slate-100">
                                <!-- Entries will be injected here -->
                            </tbody>
                        </table>
                        <div id="emptyState" class="hidden p-12 text-center">
                            <div class="bg-slate-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="text-slate-300" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                            </div>
                            <p class="text-slate-400">No transactions recorded yet.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Message -->
    <div id="toast" class="fixed bottom-8 right-8 bg-slate-900 text-white px-6 py-3 rounded-xl shadow-2xl transform translate-y-24 transition-transform duration-300 flex items-center gap-3">
        <span id="toastMsg"></span>
    </div>

    <script>
        // State Management
        let transactions = JSON.parse(localStorage.getItem('ledger_data')) || [];
        let balanceChart = null;

        // Elements
        const form = document.getElementById('ledgerForm');
        const listBody = document.getElementById('transactionList');
        const emptyState = document.getElementById('emptyState');
        const filterCat = document.getElementById('filterCategory');
        const searchInput = document.getElementById('search');

        // Initial render
        window.onload = () => {
            render();
            initChart();
        };

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const desc = document.getElementById('desc').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value || 'Uncategorized';
            
            const transaction = {
                id: Date.now(),
                desc,
                amount: type === 'expense' ? -Math.abs(amount) : Math.abs(amount),
                category,
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                timestamp: new Date().getTime()
            };

            transactions.unshift(transaction);
            save();
            render();
            form.reset();
            showToast('Transaction recorded successfully');
        });

        function save() {
            localStorage.setItem('ledger_data', JSON.stringify(transactions));
        }

        function deleteTransaction(id) {
            transactions = transactions.filter(t => t.id !== id);
            save();
            render();
            showToast('Entry deleted');
        }

        function clearAll() {
            if (confirm('Are you sure you want to clear all history?')) {
                transactions = [];
                save();
                render();
                showToast('Ledger cleared');
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            toast.style.transform = 'translateY(0)';
            setTimeout(() => {
                toast.style.transform = 'translateY(150%)';
            }, 3000);
        }

        function render() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedCat = filterCat.value;

            const filtered = transactions.filter(t => {
                const matchesSearch = t.desc.toLowerCase().includes(searchTerm) || t.category.toLowerCase().includes(searchTerm);
                const matchesCat = selectedCat === 'all' || t.category === selectedCat;
                return matchesSearch && matchesCat;
            });

            // Update Totals
            let income = 0;
            let expense = 0;
            
            transactions.forEach(t => {
                if (t.amount > 0) income += t.amount;
                else expense += Math.abs(t.amount);
            });

            const balance = income - expense;

            document.getElementById('totalIncome').innerText = `$${income.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('totalExpenses').innerText = `$${expense.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('totalBalance').innerText = `$${balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            
            // Progress bar
            const totalVolume = income + expense;
            const progress = totalVolume > 0 ? (income / totalVolume) * 100 : 0;
            document.getElementById('balanceProgress').style.width = `${progress}%`;

            // List render
            listBody.innerHTML = '';
            if (filtered.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                filtered.forEach(t => {
                    const row = document.createElement('tr');
                    row.className = 'transaction-row border-b border-slate-50';
                    row.innerHTML = `
                        <td class="px-6 py-4 text-xs text-slate-400 whitespace-nowrap">${t.date}</td>
                        <td class="px-6 py-4 font-medium text-slate-700">${t.desc}</td>
                        <td class="px-6 py-4 text-right">
                            <span class="px-2 py-1 rounded-md text-[10px] font-bold bg-slate-100 text-slate-600 uppercase">
                                ${t.category}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right font-bold ${t.amount > 0 ? 'text-emerald-600' : 'text-rose-600'}">
                            ${t.amount > 0 ? '+' : ''}${t.amount.toLocaleString(undefined, {minimumFractionDigits: 2})}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <button onclick="deleteTransaction(${t.id})" class="p-2 text-slate-300 hover:text-rose-500 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                            </button>
                        </td>
                    `;
                    listBody.appendChild(row);
                });
            }

            // Update Categories Filter
            const uniqueCats = [...new Set(transactions.map(t => t.category))];
            const currentFilter = filterCat.value;
            filterCat.innerHTML = '<option value="all">All Categories</option>';
            uniqueCats.forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.innerText = cat;
                if(cat === currentFilter) opt.selected = true;
                filterCat.appendChild(opt);
            });

            updateChart(income, expense);
        }

        // Charting
        function initChart() {
            const ctx = document.getElementById('balanceChart').getContext('2d');
            balanceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Income', 'Expenses'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#10b981', '#f43f5e'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: { family: 'Inter', size: 12 }
                            }
                        }
                    }
                }
            });
        }

        function updateChart(income, expense) {
            if (!balanceChart) return;
            if (income === 0 && expense === 0) {
                balanceChart.data.datasets[0].data = [1, 0];
                balanceChart.data.datasets[0].backgroundColor = ['#f1f5f9', '#f43f5e'];
            } else {
                balanceChart.data.datasets[0].data = [income, expense];
                balanceChart.data.datasets[0].backgroundColor = ['#10b981', '#f43f5e'];
            }
            balanceChart.update();
        }

        // Search & Filter Events
        searchInput.addEventListener('input', render);
        filterCat.addEventListener('change', render);

        // CSV Export
        function exportToCSV() {
            if (transactions.length === 0) {
                showToast('Nothing to export');
                return;
            }
            const headers = ['Date', 'Description', 'Category', 'Amount'];
            const rows = transactions.map(t => [t.date, t.desc, t.category, t.amount]);
            
            let csvContent = "data:text/csv;charset=utf-8," 
                + headers.join(",") + "\n"
                + rows.map(e => e.join(",")).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `ledger_export_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>